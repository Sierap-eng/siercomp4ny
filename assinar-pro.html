x<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upgrade PRO - SierCompany</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        .check-list li { display: flex; align-items: start; gap: 10px; margin-bottom: 12px; font-size: 14px; color: #374151; }
        .modal-fundo { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); z-index:99; display:none; justify-content:center; align-items:center; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col items-center py-10 px-4 font-sans">

    <div class="max-w-md w-full bg-white rounded-3xl shadow-xl overflow-hidden border border-gray-100">
        <div class="bg-[#111111] p-6 text-center">
            <h1 class="text-xl font-bold text-white mb-1">Seja <span class="text-[#D4AF37]">PARCEIRO PRO</span></h1>
            <p class="text-gray-400 text-xs">Venda muito mais com ferramentas exclusivas</p>
        </div>

        <div class="p-6 bg-yellow-50/50">
            <h3 class="font-bold text-gray-800 mb-4 ml-1">O que você ganha:</h3>
            <ul class="check-list">
                <li><i data-lucide="crown" class="w-5 h-5 text-[#D4AF37] fill-current"></i> <div><strong>Destaque Ouro:</strong> Sua loja no topo.</div></li>
                <li><i data-lucide="message-circle" class="w-5 h-5 text-green-500"></i> <div><strong>WhatsApp Liberado:</strong> Contato direto.</div></li>
                <li><i data-lucide="map-pin" class="w-5 h-5 text-blue-500"></i> <div><strong>Mapa Interativo:</strong> Localização exata.</div></li>
                <li><i data-lucide="images" class="w-5 h-5 text-purple-500"></i> <div><strong>Galeria e Links:</strong> Fotos e Instagram liberados.</div></li>
            </ul>
        </div>

        <div id="boxUpsell" class="hidden px-6 pb-2">
            <label class="flex items-center gap-3 p-4 border-2 border-purple-100 bg-purple-50 rounded-xl cursor-pointer hover:border-purple-300 transition-all">
                <input type="checkbox" id="checkBanner" onchange="calcularTotal()" class="w-5 h-5 text-purple-600 rounded focus:ring-purple-500">
                <div class="flex-1">
                    <p class="font-bold text-purple-900 text-sm">Adicionar Banner no Topo</p>
                    <p class="text-xs text-purple-600" id="txtValorBanner">+ R$ 49,90 (Destaque Máximo)</p>
                </div>
                <i data-lucide="rocket" class="w-5 h-5 text-purple-500"></i>
            </label>
        </div>

        <div class="p-8 text-center border-t border-gray-100">
            <p class="text-gray-500 text-sm font-medium uppercase">Total a Pagar</p>
            <div class="flex justify-center items-baseline my-2">
                <span class="text-xl text-gray-500 mr-1">R$</span>
                <span class="text-5xl font-black text-gray-900 transition-all" id="valorDisplay">49,90</span>
            </div>
            <button onclick="abrirPagamento()" id="btnPagar" class="w-full mt-4 bg-[#D4AF37] hover:bg-[#b5952f] text-white font-bold py-4 rounded-xl shadow-lg transition flex justify-center gap-2 items-center text-lg">
                PAGAR AGORA <i data-lucide="qr-code" class="w-5 h-5"></i>
            </button>
            <a href="index.html" class="block text-center text-gray-400 text-xs mt-4 hover:text-gray-600">Voltar para Vitrine</a>
        </div>
    </div>

    <div id="modal-pix" class="modal-fundo">
        <div class="bg-white p-6 rounded-2xl max-w-sm w-[90%] relative shadow-2xl animate-fade-in">
            <button onclick="document.getElementById('modal-pix').style.display='none'" class="absolute top-3 right-3 text-gray-400"><i data-lucide="x"></i></button>
            <div class="text-center">
                <h3 class="text-lg font-bold text-gray-800 mb-1">Pagamento via Pix</h3>
                <p class="text-sm text-gray-500 mb-4" id="descPix">Plano PRO</p>
                <div class="bg-yellow-50 border border-yellow-200 rounded p-3 mb-4 text-left text-xs">
                    <p class="font-bold text-yellow-800 mb-1">DADOS:</p>
                    <p><strong>Nome:</strong> Erica Rios Oliveira Dias</p>
                    <p><strong>Banco:</strong> Cora SCD</p>
                    <p><strong>Chave:</strong> CNPJ (Abaixo)</p>
                </div>
                <div class="flex justify-center mb-4 p-2 border rounded"><div id="qrcode"></div></div>
                <div class="flex gap-2 mb-4">
                    <input type="text" id="pixCopiaCola" readonly class="w-full text-xs bg-gray-100 border p-2 rounded truncate">
                    <button onclick="copiarPix()" class="bg-blue-600 text-white px-3 rounded font-bold"><i data-lucide="copy" class="w-4 h-4"></i></button>
                </div>
                <a id="btnZap" href="#" target="_blank" class="block w-full bg-green-500 text-white font-bold py-3 rounded-lg flex items-center justify-center gap-2 hover:bg-green-600">
                    <i data-lucide="message-circle" class="w-4 h-4"></i> Enviar Comprovante
                </a>
            </div>
        </div>
    </div>

   <script>
        lucide.createIcons();
        
        // ⚠️ COLE SUAS CHAVES AQUI
        const URL_API = 'https://zjtnlyjrxkwybqesszyd.supabase.co';
        const KEY_API = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpqdG5seWpyeGt3eWJxZXNzenlkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk1NzAwNDQsImV4cCI6MjA4NTE0NjA0NH0.1VxX3-qsFhZK9iRfNrofqQT28l0j9F2dfOmC4RR0CpY';
        const client = supabase.createClient(URL_API, KEY_API);

        const PIX_CHAVE = "35703153000180"; 
        const PIX_NOME = "Erica Rios Oliveira Dias"; 
        const PIX_CIDADE = "Salvador"; 
        const MEU_ZAP = "55719999466243";

        // VALORES PADRÃO (FALLBACK)
        let precoBase = 49.90;
        let precoBanner = 49.90;
        let total = precoBase;

        async function carregarDados() {
            try {
                // Tenta carregar Upsell
                const { data: config } = await client.from('config').select('ativo').eq('chave', 'upsell_banner').single();
                
                // Tenta carregar Preços
                const { data: precos } = await client.from('precos').select('*');
                
                if (precos && precos.length > 0) {
                    precos.forEach(p => {
                        if (p.chave === 'plano_pro') precoBase = parseFloat(p.valor);
                        if (p.chave === 'banner_30d') precoBanner = parseFloat(p.valor);
                    });
                    
                    // Atualiza display com valor novo
                    document.getElementById('valorDisplay').innerText = precoBase.toLocaleString('pt-BR', {minimumFractionDigits: 2});
                    document.getElementById('txtValorBanner').innerText = `+ R$ ${precoBanner.toLocaleString('pt-BR', {minimumFractionDigits: 2})} (Destaque Máximo)`;
                }

                if (config && config.ativo === true) {
                    document.getElementById('boxUpsell').classList.remove('hidden');
                }

                calcularTotal();

            } catch (error) {
                console.log("Usando valores padrão offline.");
            }
        }

        window.calcularTotal = function() {
            const temBanner = document.getElementById('checkBanner').checked;
            total = temBanner ? (precoBase + precoBanner) : precoBase;
            document.getElementById('valorDisplay').innerText = total.toLocaleString('pt-BR', {minimumFractionDigits: 2});
        }

        window.abrirPagamento = function() {
            document.getElementById('modal-pix').style.display = 'flex';
            document.getElementById('qrcode').innerHTML = "";
            
            const temBanner = document.getElementById('checkBanner').checked;
            const desc = temBanner ? "Plano PRO + Banner" : "Plano PRO";
            document.getElementById('descPix').innerText = desc;

            const payload = gerarPayloadPix(PIX_CHAVE, PIX_NOME, PIX_CIDADE, total.toFixed(2), "SIERPRO");
            setTimeout(() => { new QRCode(document.getElementById("qrcode"), { text: payload, width: 160, height: 160 }); }, 100);
            document.getElementById('pixCopiaCola').value = payload;
            
            const msg = `Olá! Fiz o pagamento de *${desc}* (R$ ${total.toFixed(2)}). Segue o comprovante:`;
            document.getElementById('btnZap').href = `https://wa.me/${MEU_ZAP}?text=${encodeURIComponent(msg)}`;
        }

        function copiarPix() {
            const el = document.getElementById("pixCopiaCola"); el.select(); el.setSelectionRange(0,99999);
            navigator.clipboard.writeText(el.value); alert("Copiado!");
        }

        function gerarPayloadPix(chave, nome, cidade, valor, txtId) {
            const nomeT = nome.substring(0,25).toUpperCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
            const cidadeT = cidade.substring(0,15).toUpperCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
            const val = valor.toString();
            const merchant = `0014BR.GOV.BCB.PIX01${chave.length}${chave}`;
            let p = `00020126${merchant.length}${merchant}520400005303986540${val.length}${val}5802BR59${(nomeT.length<10?'0':'')+nomeT.length}${nomeT}60${(cidadeT.length<10?'0':'')+cidadeT.length}${cidadeT}62070503***6304`;
            return p + crc16(p);
        }
        function crc16(buffer) {
            let crc = 0xFFFF;
            for (let i = 0; i < buffer.length; i++) {
                crc = ((crc >>> 8) | (crc << 8)) & 0xffff;
                crc ^= (buffer.charCodeAt(i) & 0x00ff);
                crc ^= ((crc & 0xff) >> 4);
                crc ^= (crc << 12) & 0xffff;
                crc ^= ((crc & 0xFF) << 5) & 0xffff;
            }
            return crc.toString(16).toUpperCase().padStart(4, '0');
        }

        carregarDados();
    </script>
</body>
</html>

    

