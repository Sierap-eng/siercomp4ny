<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SierCompany - Vitrine</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { sier: { blue: '#0066FF', dark: '#111111', gold: '#D4AF37' }, whatsapp: '#25D366' },
                    fontFamily: { sans: ['Inter', 'sans-serif'] }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .swiper { width: 100%; border-radius: 12px; }
        .swiper-slide { overflow: hidden; border-radius: 12px; }
        
        /* === AJUSTE DE ALTURA DO BANNER (REDUZIDO PELA METADE) === */
        .swiper-slide img { width: 100%; height: 80px; object-fit: cover; display: block; }
        @media (min-width: 768px) { .swiper-slide img { height: 160px; } }
        
        .card-image-wrapper { height: 130px; overflow: hidden; position: relative; }
        .card-image { width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s; }
        .group:hover .card-image { transform: scale(1.05); }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">

    <header class="bg-sier-dark sticky top-0 z-50 shadow-lg border-b border-gray-800">
        <div class="max-w-5xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between mb-4">
                <div class="flex items-center gap-2">
                    <h1 class="text-2xl font-bold text-white tracking-tighter">SIER<span class="text-sier-blue">COMP4NY</span></h1>
                </div>
                <div class="flex gap-2">
                    <a href="admin.html" class="text-gray-600 hover:text-white px-2 py-2" title="Painel do Dono"><i data-lucide="lock" class="w-4 h-4"></i></a>
                    <a href="cadastro.html" class="bg-sier-blue text-white text-xs font-bold px-4 py-2 rounded-full hover:bg-blue-600 transition shadow-lg">Divulgar Gr√°tis</a>
                </div>
            </div>
            <div class="relative">
                <input type="text" id="searchInput" placeholder="Busque lojas, lanches, servi√ßos..." class="w-full pl-10 pr-4 py-3 rounded-xl bg-gray-800 text-white border border-gray-700 focus:border-sier-blue outline-none transition-all">
                <i data-lucide="search" class="absolute left-3 top-3.5 text-gray-500 w-5 h-5"></i>
            </div>
        </div>
        <div class="bg-white/5 border-t border-white/10 backdrop-blur-md">
            <div class="max-w-5xl mx-auto px-4 py-3 flex space-x-2 overflow-x-auto no-scrollbar">
                <button onclick="filtrar('Todos')" class="px-4 py-2 rounded-full text-xs font-bold bg-sier-blue text-white shadow">Tudo</button>
                <button onclick="filtrar('Alimenta√ß√£o')" class="px-4 py-2 rounded-full text-xs bg-gray-800 text-gray-300 border border-gray-700 hover:bg-gray-700">üçî Lanches</button>
                <button onclick="filtrar('Moda')" class="px-4 py-2 rounded-full text-xs bg-gray-800 text-gray-300 border border-gray-700 hover:bg-gray-700">üëï Moda</button>
                <button onclick="filtrar('Servi√ßos')" class="px-4 py-2 rounded-full text-xs bg-gray-800 text-gray-300 border border-gray-700 hover:bg-gray-700">üîß Servi√ßos</button>
                <button onclick="filtrar('Sa√∫de')" class="px-4 py-2 rounded-full text-xs bg-gray-800 text-gray-300 border border-gray-700 hover:bg-gray-700">üíä Sa√∫de</button>
                <button onclick="filtrar('Automotivo')" class="px-4 py-2 rounded-full text-xs bg-gray-800 text-gray-300 border border-gray-700 hover:bg-gray-700">üöó Carros</button>
            </div>
        </div>
    </header>

    <main class="flex-grow max-w-5xl mx-auto px-4 mt-6 space-y-6 pb-12 w-full">
        <div id="areaBanners" class="hidden w-full">
            <div class="swiper mySwiper shadow-sm border border-gray-200 bg-white">
                <div class="swiper-wrapper" id="bannerWrapper"></div>
                <div class="swiper-pagination"></div>
            </div>
            <div class="text-right mt-1">
                <a href="anunciar.html" class="text-[10px] font-bold text-gray-400 hover:text-sier-blue flex justify-end items-center gap-1 transition">
                    <i data-lucide="rocket" class="w-3 h-3"></i> Quero Anunciar
                </a>
            </div>
        </div>
        
        <h2 class="text-lg font-bold text-gray-900 flex items-center gap-2 border-l-4 border-sier-blue pl-3">Destaques da Regi√£o</h2>
        <div id="storesGrid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
            <div class="animate-pulse bg-white h-56 rounded-xl border border-gray-200"></div>
            <div class="animate-pulse bg-white h-56 rounded-xl border border-gray-200"></div>
        </div>
        <div id="emptyState" class="hidden text-center py-12 text-gray-500">
            <i data-lucide="store" class="w-12 h-12 mx-auto text-gray-300 mb-2"></i>
            <p>Nenhuma loja encontrada.</p>
        </div>
    </main>

    <footer class="bg-black py-10 border-t border-gray-900 mt-auto text-center">
        <div class="flex justify-center gap-4 mb-6"><a href="politica.html" class="text-gray-500 text-xs hover:text-white">Termos</a><a href="admin.html" class="text-gray-500 text-xs hover:text-white">√Årea do Parceiro</a></div>
        <div class="border-t border-gray-800 w-1/2 mx-auto mb-6"></div>
        <p class="text-gray-400 text-sm mb-1">Tecnologia <span class="text-[#FF6600] font-bold">Sier Growth</span></p>
        <p class="text-[10px] text-gray-600 font-medium">Dias Anderson ‚Ä¢ Founder & Lead Developer</p>
    </footer>

    <script>
        lucide.createIcons();
        const URL_PROJETO = 'https://zjtnlyjrxkwybqesszyd.supabase.co'; 
        const CHAVE_API = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpqdG5seWpyeGt3eWJxZXNzenlkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk1NzAwNDQsImV4cCI6MjA4NTE0NjA0NH0.1VxX3-qsFhZK9iRfNrofqQT28l0j9F2dfOmC4RR0CpY'; 
        const client = supabase.createClient(URL_PROJETO, CHAVE_API);
        let allStores = []; 
        async function iniciar() { await carregarBanners(); await carregarLojas(); }

        window.registrarClick = async function(lojaId, segmento, tipo) {
            try { await client.from('clicks').insert([{ loja_id: lojaId, segmento: segmento, tipo: tipo }]); } catch(e) {}
        }

        async function carregarBanners() {
            const { data } = await client.from('banners').select('*').eq('status', 'ativo').order('created_at', {ascending: false});
            const bannersValidos = data ? data.filter(b => b.imagem_url) : [];
            if (bannersValidos.length > 0) {
                document.getElementById('areaBanners').classList.remove('hidden');
                document.getElementById('bannerWrapper').innerHTML = bannersValidos.map(b => {
                    // CORRE√á√ÉO DO LINK DO BANNER (Adiciona HTTPS se faltar)
                    let link = b.link_destino;
                    if(link && !link.startsWith('http')) link = 'https://' + link;
                    return `<div class="swiper-slide">${link ? `<a href="${link}" target="_blank"><img src="${b.imagem_url}"></a>` : `<img src="${b.imagem_url}">`}</div>`;
                }).join('');
                new Swiper(".mySwiper", { loop: bannersValidos.length>1, autoplay: { delay: 3500 }, pagination: { clickable: true } });
            }
        }

        async function carregarLojas() {
            const { data } = await client.from('lojas').select('*').eq('ativo', true).order('created_at', { ascending: false });
            if (data) { allStores = data.sort((a, b) => (a.plano === 'pro' && b.plano !== 'pro') ? -1 : 1); renderStores(allStores); }
        }

        function renderStores(stores) {
            const grid = document.getElementById('storesGrid'); grid.innerHTML = '';
            if (!stores || stores.length === 0) { grid.classList.add('hidden'); document.getElementById('emptyState').classList.remove('hidden'); return; }
            grid.classList.remove('hidden'); document.getElementById('emptyState').classList.add('hidden');
            stores.forEach(store => {
                const isPro = store.plano === 'pro';
                const borderClass = isPro ? 'border border-[#D4AF37] shadow-md' : 'border border-gray-100';
                const badge = isPro ? '<span class="absolute top-2 right-2 bg-black text-[#D4AF37] text-[10px] font-bold px-2 py-0.5 rounded shadow z-10 flex items-center gap-1 border border-[#D4AF37]"><i data-lucide="crown" class="w-3 h-3 fill-current"></i> PARCEIRO PRO</span>' : '';
                
                let botoesRodape = '';
                if(isPro) {
                    const linkZap = `https://wa.me/55${store.whatsapp.replace(/\D/g,'')}`;
                    botoesRodape = `<a href="${linkZap}" target="_blank" onclick="registrarClick('${store.id}', '${store.categoria}', 'whatsapp')" class="flex items-center justify-center gap-1.5 text-xs font-bold text-white bg-whatsapp hover:bg-green-600 py-2 rounded-lg transition w-full shadow-sm"><i data-lucide="message-circle" class="w-3.5 h-3.5"></i> WhatsApp</a>`;
                } else {
                    // TEXTO DO BOT√ÉO CORRIGIDO PARA "Seja PRO"
                    botoesRodape = `<div class="flex gap-2"><a href="perfil.html?id=${store.id}" class="flex-1 text-center text-[10px] font-bold text-gray-600 border border-gray-200 bg-gray-50 py-2 rounded-lg hover:bg-gray-100">Ver</a><a href="assinar-pro.html" class="flex-1 text-center text-[10px] font-bold text-white bg-[#D4AF37] py-2 rounded-lg hover:bg-[#b5952f] shadow-sm flex items-center justify-center gap-1"><i data-lucide="zap" class="w-3 h-3"></i> Seja PRO</a></div>`;
                }
                grid.innerHTML += `<div class="bg-white rounded-xl overflow-hidden shadow-sm hover:shadow-xl transition-all ${borderClass} group h-full flex flex-col relative"><a href="perfil.html?id=${store.id}" class="block card-image-wrapper relative"><img src="${store.logo_url || 'https://placehold.co/600x400'}" class="card-image">${badge}</a><div class="p-3 flex flex-col flex-grow"><span class="text-[9px] font-bold text-gray-500 uppercase bg-gray-100 px-1.5 py-0.5 rounded border border-gray-200 w-fit mb-1">${store.categoria}</span><h3 class="text-base font-bold text-gray-900 leading-tight mb-1 truncate">${store.nome_fantasia}</h3><div class="mt-auto pt-2 border-t border-gray-50 w-full">${botoesRodape}</div></div></div>`;
            });
            lucide.createIcons();
        }
        window.filtrar = (cat) => cat === 'Todos' ? renderStores(allStores) : renderStores(allStores.filter(s => s.categoria === cat));
        document.getElementById('searchInput').addEventListener('input', (e) => renderStores(allStores.filter(s => s.nome_fantasia.toLowerCase().includes(e.target.value.toLowerCase()))));
        iniciar();
    </script>
</body>
</html>
